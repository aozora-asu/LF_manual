<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ site_name }}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      id="ui-pattern-style"
      href="{{ url_for('static', filename=ui_pattern_css) }}"
    />
    {% block head %}{% endblock %}
  </head>
  <body
    class="ui-pattern ui-pattern-{{ (ui_pattern or 'latte_notebook') | replace('_', '-') }}"
    data-ui-pattern="{{ ui_pattern or 'latte_notebook' }}"
  >
    <header class="site-header">
      <div class="header-inner">
        <div class="header-left">
          <button class="hamburger-btn" id="hamburger-btn" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <rect y="3" width="20" height="2" rx="1" fill="currentColor" />
              <rect y="9" width="20" height="2" rx="1" fill="currentColor" />
              <rect y="15" width="20" height="2" rx="1" fill="currentColor" />
            </svg>
          </button>
          <div class="site-brand">
            <h1 class="site-title">
              <a href="{{ url_for('pages.index') }}">{{ site_name }}</a>
            </h1>
            <p class="site-tagline">èª­ã¿è¿”ã—ã‚„ã™ã„ã€ã‚„ã•ã—ã„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ“ãƒ¥ãƒ¼</p>
          </div>
        </div>
        <nav class="site-nav">
          <div class="site-nav-primary">
            <a href="{{ url_for('pages.page_list') }}">ãƒšãƒ¼ã‚¸ä¸€è¦§</a>
            <a href="{{ url_for('pages.new_page') }}">æ–°è¦ä½œæˆ</a>
          </div>
          <div class="site-nav-utility">
            <div
              class="ui-pattern-switcher"
              id="ui-pattern-switcher"
              role="group"
              aria-label="è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«"
            >
              <span class="ui-pattern-label">ãƒ†ãƒ¼ãƒ:</span>
              {% for p in ui_pattern_options %}
              <button
                type="button"
                class="ui-pattern-dot {% if p.key == ui_pattern %}is-selected{% endif %}"
                data-pattern="{{ p.key }}"
                title="{{ p.label }}"
                aria-label="{{ p.label }}"
                style="--pattern-color: {{ p.color }};"
              ></button>
              {% endfor %}
            </div>
            <div class="search-wrapper">
              <form
                class="search-form"
                action="{{ url_for('search.search') }}"
                method="get"
              >
                <input
                  type="text"
                  name="q"
                  id="search-input"
                  placeholder="ãƒšãƒ¼ã‚¸ã‚’æ¤œç´¢..."
                  value="{{ request.args.get('q', '') }}"
                  autocomplete="off"
                />
                <button type="submit">æ¤œç´¢</button>
              </form>
              <div class="search-dropdown" id="search-dropdown"></div>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <div class="layout-wrapper" id="layout-wrapper">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-section-header">
            <span class="sidebar-section-title">ğŸ“š ç›®æ¬¡</span>
            <span class="sidebar-section-sub">ã¾ãšã¯ã“ã“ã‹ã‚‰ãƒšãƒ¼ã‚¸ã‚’é¸æŠ</span>
          </div>
          <div class="sidebar-quick-links">
            <a href="{{ url_for('pages.index') }}" class="sidebar-quick-link"
              >ãƒ›ãƒ¼ãƒ </a
            >
            <a
              href="{{ url_for('pages.page_list') }}"
              class="sidebar-quick-link"
              >å…¨ãƒšãƒ¼ã‚¸</a
            >
            <a href="{{ url_for('pages.new_page') }}" class="sidebar-quick-link"
              >æ–°è¦ä½œæˆ</a
            >
          </div>
          <div class="sidebar-tree" id="sidebar-tree"></div>
        </div>
        <div class="sidebar-section">
          <div class="sidebar-section-header">
            <span class="sidebar-section-title">ğŸ§º ã‚´ãƒŸç®±</span>
            <span class="sidebar-section-sub">å‰Šé™¤ã—ãŸãƒšãƒ¼ã‚¸ã‚’ç®¡ç†</span>
          </div>
          <div class="sidebar-trash" id="sidebar-trash"></div>
        </div>
        <div class="sidebar-section">
          <div class="sidebar-section-header">
            <span class="sidebar-section-title">ğŸ•˜ æ›´æ–°å±¥æ­´</span>
            <span class="sidebar-section-sub">æœ€è¿‘ã®å¤‰æ›´ã‚’ãƒã‚§ãƒƒã‚¯</span>
          </div>
          <div class="sidebar-history" id="sidebar-history"></div>
        </div>
      </aside>
      <div class="main-area" id="main-area">
        <section class="watcher-board" id="watcher-board">
          <div class="watcher-board-header">
            <div class="watcher-board-title">
              <div class="watcher-board-heading">
                <h2>Webç›£è¦–çŠ¶æ³</h2>
                <p class="watcher-board-lead">
                  å¤‰åŒ–ãŒã‚ã£ãŸé …ç›®ã‚’ã€ã²ã¨ç›®ã§ã‚„ã•ã—ãç¢ºèªã§ãã¾ã™ã€‚
                </p>
              </div>
              <a class="watcher-config-link" href="{{ admin_url }}#sec-config"
                >ç›£è¦–æ¡ä»¶ã®å¤‰æ›´</a
              >
              <label class="watcher-alert-toggle">
                <input type="checkbox" id="watcher-alert-window-enabled" />
                <span>ç•°å¸¸ãƒ»å¤‰æ›´ãŒã‚ã£ãŸæ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’å‡ºã™</span>
              </label>
            </div>
            <div class="watcher-night-controls">
              <label class="watcher-night-check">
                <input type="checkbox" id="watcher-night-enabled" />
                <span>å¤œé–“åœæ­¢</span>
              </label>
              <div class="watcher-night-range">
                <span>åœæ­¢</span>
                <input
                  type="number"
                  min="0"
                  max="23"
                  id="watcher-night-start"
                />
                <span>å†é–‹</span>
                <input type="number" min="0" max="23" id="watcher-night-end" />
              </div>
            </div>
          </div>
          <div class="watcher-board-note" id="watcher-board-note"></div>
          <div class="watcher-board-grid" id="watcher-board-grid">
            <div class="watcher-board-loading">èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
        </section>
        <main class="content">{% block content %}{% endblock %}</main>
        <footer class="site-footer">
          <p>{{ site_name }}</p>
        </footer>
      </div>
    </div>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
      (function () {
        function loadSessionId() {
          var key = "wiki-session-id";
          var existing = sessionStorage.getItem(key);
          if (existing) return existing;
          var id =
            window.crypto && crypto.randomUUID
              ? "wiki:" + crypto.randomUUID()
              : "wiki:" +
                Date.now().toString(36) +
                Math.random().toString(36).slice(2);
          sessionStorage.setItem(key, id);
          return id;
        }

        var sessionId = loadSessionId();

        function postHeartbeat(action) {
          fetch("/api/heartbeat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: action,
              session_id: sessionId,
              client: "wiki",
            }),
            keepalive: action === "close",
          }).catch(function () {});
        }

        function sendClose() {
          var payload = JSON.stringify({
            action: "close",
            session_id: sessionId,
            client: "wiki",
          });
          if (navigator.sendBeacon) {
            navigator.sendBeacon(
              "/api/heartbeat",
              new Blob([payload], { type: "application/json" }),
            );
          } else {
            postHeartbeat("close");
          }
        }

        postHeartbeat("open");
        setInterval(function () {
          postHeartbeat("ping");
        }, 5000);
        window.addEventListener("pagehide", sendClose);
        window.addEventListener("beforeunload", sendClose);
      })();
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
