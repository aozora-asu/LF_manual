{% extends "base.html" %} {% block title %}{{ page.title }} - {{ site_name }}{%
endblock %} {% block content %}
<nav class="breadcrumb">
  <div class="breadcrumb-path">
    <a href="{{ url_for('pages.index') }}">Home</a>
    {% if '/' in page.slug %} {% set parts = page.slug.split('/') %} {% for part
    in parts[:-1] %}
    <span class="breadcrumb-sep">&gt;</span>
    <span class="breadcrumb-dir">{{ part }}</span>
    {% endfor %} {% endif %}
    <span class="breadcrumb-sep">&gt;</span>
    <span class="breadcrumb-current">{{ page.title }}</span>
  </div>
  <div class="breadcrumb-meta">
    <span>更新: {{ page.updated | fmt_datetime }}</span>
    <span>作成: {{ page.created | fmt_datetime }}</span>
  </div>
</nav>
<article class="page-view">
  <div class="page-header">
    <h1>{{ page.title }}</h1>
    {% if revision %}
    <p class="revision-notice">
      <span>リビジョン {{ revision }} を表示中</span>
      <a
        href="{{ url_for('pages.view_page', slug=page.slug) }}"
        class="revision-back-link"
        title="最新版に戻る"
      >
        <span>最新版に戻る</span>
        <svg
          width="14"
          height="14"
          viewBox="0 0 16 16"
          fill="none"
          aria-hidden="true"
        >
          <path
            d="M6.5 3h6.5v6.5M12.7 3.3 6.2 9.8"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M13 8.5v3.5a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h3.5"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </a>
    </p>
    {% endif %}
    <div class="page-actions">
      <a
        href="{{ url_for('pages.edit_page', slug=page.slug) }}"
        class="icon-btn"
        title="編集"
      >
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
          <path
            d="M13.5 2.5a2.121 2.121 0 013 3L5.5 16.5 1 17.5l1-4.5L13.5 2.5z"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </a>
      <a
        href="{{ url_for('history.page_history', slug=page.slug) }}"
        class="icon-btn"
        title="履歴"
      >
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
          <circle
            cx="9"
            cy="9"
            r="7.5"
            stroke="currentColor"
            stroke-width="1.5"
          />
          <path
            d="M9 5v4.5l3 1.5"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </a>
      <button class="icon-btn" title="印刷" onclick="window.print()">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
          <path
            d="M4.5 6.5v-5h9v5"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <rect
            x="1.5"
            y="6.5"
            width="15"
            height="7"
            rx="1"
            stroke="currentColor"
            stroke-width="1.5"
          />
          <path
            d="M4.5 11.5h9v5h-9z"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
      <form
        action="{{ url_for('pages.delete_page', slug=page.slug) }}"
        method="post"
        class="inline-form"
        onsubmit="return confirm('このページを削除しますか？');"
      >
        <button type="submit" class="icon-btn icon-btn-danger" title="削除">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path
              d="M2.5 4.5h13M6 4.5V3a1.5 1.5 0 011.5-1.5h3A1.5 1.5 0 0112 3v1.5M14.5 4.5l-.75 11.25a1.5 1.5 0 01-1.5 1.25H5.75a1.5 1.5 0 01-1.5-1.25L3.5 4.5"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </form>
    </div>
  </div>
  <div class="page-body">{{ html_content | safe }}</div>
</article>

<!-- フローティングコメントボタン（テキスト選択時に表示） -->
<div id="comment-float-btn" class="comment-float-btn" style="display: none">
  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
    <path
      d="M2 2h12v9H5.5L2 14V2z"
      stroke="currentColor"
      stroke-width="1.4"
      stroke-linejoin="round"
    />
    <path
      d="M5 5.5h6M5 8h4"
      stroke="currentColor"
      stroke-width="1.2"
      stroke-linecap="round"
    />
  </svg>
  コメント
</div>

<!-- スレッドパネル（右側スライド） -->
<div id="thread-panel" class="thread-panel" data-slug="{{ page.slug }}">
  <div class="thread-panel-header">
    <h3 id="thread-panel-title">スレッド</h3>
    <button id="thread-panel-close" class="icon-btn icon-btn-sm" title="閉じる">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
        <path
          d="M2 2l8 8M10 2l-8 8"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
        />
      </svg>
    </button>
  </div>
  <div id="thread-panel-body" class="thread-panel-body"></div>
</div>
{% endblock %}
